{% extends 'partials/base.html.twig' %}

{% set show_sidebar = header_var('show_sidebar', [page, blog])|defined(true)  %}
{% set show_pagination = header_var('show_pagination', [page, blog])|defined(true) %}
{% block stylesheets %}
    {{ parent() }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {% do assets.add('theme://js/scopedQuerySelectorShim.min.js') %}
{% endblock %}

{% block body %}
    <div class="wrapper padding">
    {% embed 'partials/layout.html.twig' with {blog: page} %}
        {% block item %}
            <section id="body">
            <div class="wrapper padding">
            {% block content %}
                    {% if page.header.title %}
                <h2>{{page.header.title|e }}</h2>
                {% endif %}
                {{ page.content|raw }}
            {% endblock %}

            {% set material_items = page.collection({'items': {'@page.children': '/items'}, 'order': {'by': 'header.title', 'dir': 'asc'}}) %}
            {% if material_items.count > 0 %}
            <h3>Library items made with this material</h3>
            {# {% include('partials/lib_related_items.html.twig') with {collection: material_items, header_var: 'material_type', route: page.route} %} #}
            {# {% endif %} #}

            {% for i in material_items %}
                {% set i_routes_list = evaluate('i.header.' ~ 'material_type') %}
                {% if page.route in i_routes_list %}
                <li class="column col-xs-4 col-md-3 col-lg-1 col-mr-auto">
                    {% include 'partials/blog-list-item.html.twig' with {blog: page, page: i} %}
                </li>
                {% endif %}
            {% endfor %}
            {% endif %}

            {% set processType = page.header.processes|e %}
            {% if processType %}
            <h3>Processes used on this material</h3>
            {% include('partials/lib_related_items.html.twig') with {link_list: processType} %}
            {% endif %} 
            </div>
            </section>
        {% endblock %}
        {% block sidebar %}
            <div class="padding-top">
            {% include 'partials/sidebar.html.twig' %}
            </div>
        {% endblock %}
    {% endembed %}
    </div>
{% endblock %}